---
import { getCollection } from "astro:content";
import Footer from "../../components/Footer.astro";
import Layout from "../../layouts/Layout.astro";

// Get all blog posts and sort by publish date (newest first)
const allPosts = await getCollection("blog");
const sortedPosts = allPosts.sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime());

// Get featured posts (up to 9)
const featuredPosts = sortedPosts.filter((post) => post.data.featured).slice(0, 9);

// If we don't have 9 featured posts, fill with recent posts
const postsToShow =
    featuredPosts.length >= 9
        ? featuredPosts
        : [...featuredPosts, ...sortedPosts.filter((post) => !post.data.featured).slice(0, 9 - featuredPosts.length)];
---

<Layout title="Newsroom | PSYKHE">
  <div class="newsroom-wrapper">
    <div class="psykhe-landing">
      <div class="newsroom-container">

        <!-- Brand/Navigation -->
        <div class="brand">
          <a href="/">PSYKHE AI</a>
        </div>

        <!-- Header Section -->
        <div class="blog-header">
          <div class="container">
            <div class="header-content">
              <span class="blog-label">BLOG</span>
              <h1>Latest updates from<br>PSYKHE AI.</h1>
            </div>
          </div>
        </div>


        <!-- Blog Posts Grid -->
        <div class="container">
          <div class="blog-grid">
            {postsToShow.map((post) => (
              <article class="blog-card">
                <a href={`/blog/${post.slug}/`} class="blog-card-link">
                  <div class="blog-card-image">
                    <div class="image-placeholder">
                      <span>Feature Image</span>
                    </div>
                  </div>
                  <div class="blog-card-content">
                    <span class="category-tag" data-category={post.data.category.toLowerCase()}>
                      {post.data.category.toUpperCase()}
                    </span>
                    <h2 class="blog-title">
                      {post.data.title}
                    </h2>
                    <div class="blog-meta">
                      <span class="blog-date">
                        {post.data.publishDate.toLocaleDateString('en-US', { 
                          month: 'long', 
                          day: 'numeric',
                          year: 'numeric'
                        })}
                      </span>
                    </div>
                  </div>
                  <div class="read-more">
                    <span>Read More</span>
                  </div>
                </a>
              </article>
            ))}
          </div>
        </div>

        <!-- Book a Demo CTA -->
        <div class="container">
          <div class="blog-cta">
            <a href="/#contact" class="cta-button">Book a Demo</a>
          </div>
        </div>

      </div>
    </div>

    <Footer />
  </div>
</Layout>

<script>
// Blog functionality
document.addEventListener('DOMContentLoaded', function() {
  const blogCards = document.querySelectorAll('.blog-card') as NodeListOf<HTMLElement>;
  
  // Add hover effects
  blogCards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-4px)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
    });
  });
});
</script>

<style lang="scss">
@import '../../styles/app.scss';

.newsroom-wrapper {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.psykhe-landing {
  flex: 1;
}
</style>
