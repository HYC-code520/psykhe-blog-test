---
import FlipCounter from "../components/FlipCounter.astro";
import Footer from "../components/Footer.astro";
import Navbar from "../components/Navbar.astro";
import { SurveyQuestions } from "../data/personality-questions";
import Layout from "../layouts/Layout.astro";

const visualQuestionSets = [
  {
    id: 101,
    text: "Which do you primarily buy? (Select all that apply.)",
    answers: [
      { id: 1, text: "Womenswear" },
      { id: 2, text: "Menswear" },
      { id: 3, text: "Homeware & interiors" },
      { id: 4, text: "Beauty & personal care products" },
    ],
  },
  {
    id: 102,
    text: "Which price points do you shop at? (Select all that apply.)",
    answers: [
      { id: 1, text: "Low-range" },
      { id: 2, text: "Mid-range" },
      { id: 3, text: "High-range" },
    ],
  },
  {
    id: 103,
    text: "Your favorite brands are most like which of the following? (Select all that apply.)",
    answers: [
      { id: 1, text: "Classic all-American labels" },
      { id: 2, text: "Sporty athleisure which focus on technical fabrics" },
      { id: 3, text: "Mall brands which capture trends" },
      { id: 4, text: "Colorful, artisanal brands" },
      { id: 5, text: "Quirky, offbeat, different" },
      { id: 6, text: "Minimalist, directional high-end fashion" },
      { id: 7, text: "Traditional luxury brands" },
    ],
  },
  {
    id: 104,
    text: "How do you feel about prints? (Select all that apply.)",
    answers: [
      { id: 1, text: "Solids only", icon: "/media/b2c/solidprint.png" },
      {
        id: 2,
        text: "I like tropical prints",
        icon: "/media/b2c/tropicalprints.png",
      },
      {
        id: 3,
        text: "I like floral prints",
        icon: "/media/b2c/floralprints.png",
      },
      {
        id: 4,
        text: "I like cheques and traditional prints",
        icon: "/media/b2c/chequesprints.png",
      },
      { id: 5, text: "I love prints", icon: "/media/b2c/iloveprints.png" },
    ],
  },
  {
    id: 105,
    text: "Which is your color preference? (Select all that apply.)",
    answers: [
      { id: 1, text: "Black and white" },
      { id: 2, text: "Earthy neutrals, gray" },
      { id: 3, text: "Pastels and pale colors" },
      { id: 4, text: "Bright colors" },
      { id: 5, text: "Shiny metallics" },
    ],
  },
];
---

<Layout title="Big 5 Personality Test | PSYKHE">
  <Navbar />

  <div class="survey big-5-personality-test">
    <div id="disclaimer-screen" class="survey-disclaimer">
      <div class="survey-disclaimer-content">
        <p class="smaller">
          In under 3 minutes, you'll complete the Big Five Inventory-2 (BFI-2)
          with questions supplemented by PSYKHE AI, giving you the results of
          your unique personality profile in terms of the Big Five traits: the
          most important measure identified by psychologists for understanding
          people, their outcomes, and preferences.
        </p>

        <div class="survey-hero">
          <img src="/media/b2b/ww/hero_bigfive.jpg" alt="Hero" />
        </div>

        <div class="survey-disclaimer-actions">
          <button onclick="startTest()">Start</button>
        </div>

        <FlipCounter
          baseValue={230000}
          incrementRate={1}
          updateInterval={10000}
          label="TESTS TAKEN"
        />

        <p
          class="smaller disclaimer-copyright"
          style="font-size: 0.7rem; margin-top: auto; flex-shrink: 0;"
        >
          Big Five Inventory-2 Items Copyright 2015 By Drs. Oliver P. John and
          Christopher J. Soto. Reprinted with permission. Test results developed
          independently by PSYKHE AI, and not endorsed by Drs. John and Soto.
        </p>

        <style>
          .disclaimer-copyright {
            display: none;
          }

          @media (min-width: 1097px) {
            .disclaimer-copyright {
              display: block;
            }
          }
        </style>
      </div>
    </div>

    <div id="test-screen" style="display: none;">
      <div id="progress-container" class="survey-progress-top">
        <div class="progress-bar">
          <div id="progress" class="progress-fill"></div>
        </div>
      </div>

      <div class="survey-controls">
        <button
          id="prev-btn"
          class="survey-control-prev"
          onclick="navigatePrevious()"
          style="display: none;"
        >
          <span class="survey-control-prev-icon"></span>
          <span class="sr-only">Prev</span>
        </button>

        <button
          id="next-btn"
          class="survey-control-next"
          onclick="navigateNext()"
          style="display: none;"
        >
          <span class="survey-control-next-icon"></span>
          <span class="sr-only">Next</span>
        </button>
      </div>

      <div class="flex justify-center relative">
        <div id="survey-section" class="survey-question" style="display: none;">
          <div class="survey-question-title">
            <div id="question-circle" class="question-circle">
              <div id="question-indicator" class="question-number-indicator">
              </div>
              <span id="question-text"></span>
            </div>
          </div>

          <p
            class="survey-question-proceed-message survey-question-proceed-message-top"
          >
            Click the right arrow to proceed to the next question.
          </p>

          <form
            id="survey-form"
            class="survey-form row flex flex-col gap-3 md:gap-4"
          >
          </form>

          <p
            class="survey-question-proceed-message survey-question-proceed-message-bottom"
          >
            Click the right arrow to proceed to the next question.
          </p>
        </div>

        <div
          id="visual-section"
          class="visual-section survey-question"
          style="display: none;"
        >
          <div class="survey-question-title">
            <div id="visual-question-circle" class="question-circle">
              <div
                id="visual-question-indicator"
                class="question-number-indicator"
              >
              </div>
              <span id="visual-question-text"></span>
            </div>
          </div>

          <p
            class="survey-question-proceed-message survey-question-proceed-message-top"
          >
            Select at least one option and click the right arrow to proceed.
          </p>

          <form id="visual-form" class="row"></form>

          <p
            class="survey-question-proceed-message survey-question-proceed-message-bottom"
          >
            Select at least one option and click the right arrow to proceed.
          </p>
        </div>

        <div
          id="user-info-section"
          class="user-info-section"
          style="display: none;"
        >
          <h2 class="survey-question-title">
            Almost there! Tell us about yourself
          </h2>

          <p
            class="survey-question-proceed-message survey-question-proceed-message-top"
          >
            Please provide your information to see your results.
          </p>

          <form class="user-info-form">
            <div class="form-group">
              <label for="firstName"
                >First Name <span class="required">*</span></label
              >
              <input
                id="firstName"
                type="text"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
                placeholder="Enter your first name"
                name="given-name"
                autocomplete="given-name"
              />
            </div>

            <div class="form-group">
              <label for="lastName">Last Name <small>(optional)</small></label>
              <input
                id="lastName"
                type="text"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Enter your last name"
                name="family-name"
                autocomplete="family-name"
              />
            </div>

            <div class="form-group">
              <label for="email"
                >Email Address <span class="required">*</span></label
              >
              <input
                id="email"
                type="email"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
                placeholder="Enter your email address"
                name="email"
                autocomplete="email"
              />
            </div>

            <div class="form-group">
              <label for="retailerNames">
                At which retailers would you like to have a more personalized
                experience?
                <small>(optional)</small>
              </label>
              <input
                id="retailerNames"
                type="text"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Enter retailer names"
                autocomplete="off"
                maxlength="250"
              />
            </div>

            <div class="checkbox-container">
              <input id="optInUpdate" type="checkbox" class="checkbox-input" />
              <label class="checkbox-label" for="optInUpdate">
                I agree to receive occasional updates from PSYKHE AI.
              </label>
            </div>

            <div class="checkbox-container">
              <input
                id="optInParticipateInRetails"
                type="checkbox"
                class="checkbox-input"
              />
              <label class="checkbox-label" for="optInParticipateInRetails">
                I would like to use my data to opt-in to a hyper-personalized
                shopping experience at participating retailers.
              </label>
            </div>

            <div class="checkbox-container">
              <input
                id="termsConsent"
                type="checkbox"
                class="checkbox-input"
                required
              />
              <label class="checkbox-label" for="termsConsent">
                <span class="required">*</span> I agree to the
                <a href="/terms-and-conditions/" target="_blank"
                  >Terms and Conditions</a
                >
              </label>
            </div>

            <button
              type="button"
              class="submit-user-info"
              id="submit-user-info"
              onclick="submitUserInfo()"
            >
              See My Results
            </button>
          </form>

          <p
            class="survey-question-proceed-message survey-question-proceed-message-bottom"
          >
            Your information is secure and will only be used as described in our
            privacy policy.
          </p>
        </div>

        <div
          id="results-section"
          class="summary-section"
          style="display: none;"
        >
          <div
            id="download-notification"
            class="download-notification"
            style="display: none;"
          >
            <span id="notification-text"></span>
          </div>

          <div class="result-page-desktop-layout">
            <div class="result-photo-container">
              <div id="photo-label" class="photo-label"></div>
              <img
                id="result-photo"
                class="result-photo"
                alt="Personality result"
              />
            </div>

            <div class="desktop-legend">
              <span>HIGH = 5 • </span>
              <span>MODERATE-HIGH = 4 • </span>
              <span>MODERATE = 3 • </span>
              <span>MODERATE-LOW = 2 • </span>
              <span>LOW = 1</span>
            </div>

            <div class="result-content-container">
              <div class="profile-top">
                <div class="row">
                  <section class="page-profile-intro">
                    <div class="title-section">
                      <h3 id="profile-title" class="profile-title">
                        <button
                          class="info-popup-trigger"
                          onmouseover="showInfoPopup()"
                          onmouseleave="hideInfoPopup()"></button>
                      </h3>
                      <hr class="title-separator" />

                      <div
                        id="info-popup"
                        class="info-popup"
                        style="display: none;"
                      >
                        <p>
                          Using a version of the Big 5 model of personality
                          traits, we've calculated your scores below. Within
                          psychology, this model is the most trusted framework
                          for measuring personality, and has a known
                          relationship with a variety of preferences. If you've
                          ever wondered why you're drawn to certain brands,
                          clothes, music, or hobbies, your personality scores
                          can help you understand why.
                        </p>

                        <p>
                          Your core personal style is arrived at from how the
                          five scores combine and interact together, and not
                          from one score alone, for an aesthetic and lifestyle
                          that's uniquely yours. Read on for an explanation of
                          how you scored within each scale.
                        </p>
                      </div>
                    </div>
                  </section>

                  <section class="profile-trait-bars mob-vis-sm">
                    <div role="tablist" id="mobile-trait-bars"></div>
                  </section>

                  <div class="profile-top-message mob-vis-sm">
                    ⬆ Tap the result above for more detail. ⬇
                  </div>
                </div>

                <div class="trait-navigation-arrows">
                  <button
                    class="trait-arrow trait-arrow-left"
                    id="trait-prev"
                    onclick="navigateTrait(-1)"
                    title="Previous trait"
                  >
                    <img
                      src="/media/b2c/personality-test/left-arrow-button.png"
                      alt="Previous"
                    />
                  </button>

                  <button
                    class="trait-arrow trait-arrow-right"
                    onclick="navigateTrait(1)"
                    title="Next trait"
                  >
                    <img
                      src="/media/b2c/personality-test/right-arrow-button.png"
                      alt="Next"
                    />
                  </button>
                </div>

                <div class="page-profile-trait-tabs">
                  <div id="desktop-tabs" class="mob-hide-sm"></div>
                </div>

                <div class="page-profile-trait-content">
                  <div class="mob-vis-sm tab-content">
                    <div id="mobile-trait-header" class="mobile-trait-header">
                    </div>
                    <div id="mobile-trait-content"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="floating-action-buttons">
            <button
              class="fab-button fab-download"
              title="Download Results"
              onclick="downloadResults()"
            >
              <img
                src="/media/b2c/personality-test/Test-Download-bttn.png"
                alt="Download Results"
              />
            </button>

            <button
              class="fab-button fab-share"
              title="Share Results"
              onclick="shareResults()"
            >
              <img
                src="/media/b2c/personality-test/Test-Share-bttn.png"
                alt="Share Results"
              />
            </button>

            <button
              class="fab-button fab-retake"
              title="Retake Test"
              onclick="retakeTest()"
            >
              <img
                src="/media/b2c/personality-test/Test-Retake-bttn.png"
                alt="Retake Test"
              />
            </button>
          </div>

          <div class="bottom-action-buttons d-none d-md-flex">
            <button class="gradient-button retake-button" onclick="retakeTest()"
              >Take test again</button
            >
            <button
              class="gradient-button download-button"
              onclick="downloadResults()">Download result</button
            >
            <button
              class="gradient-button share-button"
              onclick="shareResults()">Share with a friend</button
            >
          </div>

          <div
            id="trait-hint"
            class="trait-navigation-hint"
            style="display: none;"
          >
            <div class="hint-content">
              <button class="hint-close" onclick="dismissTraitHint()">
                <span>×</span>
              </button>

              <div class="mob-hide-sm">
                <div class="hint-message">
                  <span class="hint-icon">💡</span>
                  <span
                    >Click on the trait tabs or use the arrow buttons to explore
                    all 5 personality traits!</span
                  >
                </div>
              </div>

              <div class="mob-vis-sm">
                <div class="hint-message">
                  <span class="hint-icon">💡</span>
                  <span
                    >Tap on the trait bars to see detailed descriptions of each
                    personality trait!</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="bottom-progress" class="survey-progress-bottom">
        <div class="progress-bar">
          <div id="bottom-progress-fill" class="progress-fill"></div>
        </div>
      </div>
    </div>
  </div>

  <Footer />
</Layout>

<script is:inline src="/scripts/trait-content-data.js"></script>

<script is:inline src="/scripts/download-functionality.js"></script>

<script is:inline src="/scripts/personality-test-logic.js"></script>

<script
  define:vars={{
    surveyQuestions: SurveyQuestions,
    visualQuestions: visualQuestionSets,
  }}
>
  document.addEventListener("DOMContentLoaded", function () {
    if (typeof window.traitContent !== "undefined") {
      window.traitContent = window.traitContent;
      console.log("Trait content loaded:", Object.keys(window.traitContent));
    } else {
      console.error("Trait content not loaded!");
    }

    initializePersonalityTest(surveyQuestions, visualQuestions);
  });
</script>
